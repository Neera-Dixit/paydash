!function(){"use strict";function t(t){_.data=t,o(),r(),s(_.data.panchayats),i()}function e(t,e,n,l){if(""!==e){var s=new Date;s.setDate(s.getDate()-e)}var o=[];return t.forEach(function(t,e){(!s||a(t[0])>=s)&&n.forEach(function(e,n){var s={date:a(t[0])};s.value=l&&o[n-1]?t[e]+o[n-1][o[n-1].length-1].value:t[e],s.total_trans=t[8],o[n]=o[n]||[],o[n].push(s)})}),o}function a(t){var e=t.substring(0,4),a=t.substring(4,6),n=t.substring(6,8);return new Date(e,a,n)}function n(){if(""!==_.past_n_days){var t=new Date;t.setDate(t.getDate()-_.past_n_days)}var e=10;return _.stepwise_compare_lines.forEach(function(n,l){_.data[n].data.forEach(function(n){_.stepCols.forEach(function(l){(!t||a(n[0])>=t)&&n[l]>e&&(e=n[l])})})}),e}function l(){if(""!==_.past_n_days){var t=new Date;t.setDate(t.getDate()-_.past_n_days)}var e=10;return _.data.panchayats.forEach(function(n,l){n.data.forEach(function(n){_.stepCols.forEach(function(l){(!t||a(n[0])>=t)&&n[l]>e&&(e=n[l])})})}),console.log(e),e}function s(t){d3.select(".panchayat_charts-container").selectAll("div").data(t).enter().append("div").classed("pure-u-6-24",!0).html(function(t,e){return'<div class="chart-holder small_chart"><div id="p_'+t.panchayat_code+'"></div><div class="p_'+t.panchayat_code+'_legend"></div></div>'})}function o(){var t=e(_.data.block.data,_.past_n_days,_.stepCols,!0);c({data:t,title:"Block Performance",target:"#block_performance",legend_target:".legend",labels:_.labels})}function r(){n();_.stepCols.forEach(function(t,a){var n=[];_.stepwise_compare_lines.forEach(function(a,l){var s=e(_.data[a].data,_.past_n_days,[t],!1);n.push(s[0])}),d({data:n,title:_.data.config.headers[t],target:"#s_"+t,legend_target:".s_"+t+"_legend",labels:_.labels,area:!1})})}function i(){var t=l();_.data.panchayats.forEach(function(a,n){var l=""!==_.panchyat_compare_lines?[_.panchyat_compare_lines]:_.stepCols,s=""===_.panchyat_compare_lines?!0:!1,o=e(a.data,_.past_n_days,l,s);console.log(o),d({data:o,title:a.panchayat_name,target:"#p_"+a.panchayat_code,legend_target:".p_"+a.panchayat_code+"_legend",labels:_.labels,max_y:t})})}function c(t){MG.data_graphic({title:t.title,data:t.data,width:600,height:400,left:80,full_width:!0,target:t.target,baselines:[{value:15,label:"Ideal"}],xax_count:20,legend:t.labels,legend_target:t.legend_target,show_tooltips:!1,aggregate_rollover:!0,show_year_markers:!0,transition_on_update:!1,interplate:"linear",interpolate_tension:1,area:!0,y_label:"Days",mouseover:function(t,e){t.values.forEach(function(t,e){var a=d3.formatPrefix(t.value),n=d3.select(".legend .mg-line"+t.line_id+"-legend-color");n.text(" "),n.text("— "+_.labels[e]+" : "+a.scale(t.value).toFixed(2)),d3.select("#total_trans").text(t.total_trans)})},mouseout:function(t,e){t.values.forEach(function(t,e){var a=d3.select(".legend .mg-line"+t.line_id+"-legend-color");a.text(" "),a.text("— "+_.labels[e])})}})}function d(t){MG.data_graphic({title:t.title,data:t.data,width:295,height:200,right:10,left:80,small_text:!0,xax_count:1,chart_type:0!==t.data.length?"line":"missing-data",missing_text:"No data",target:t.target,full_width:!0,transition_on_update:!1,max_y:t.max_y||void 0,interplate:"linear",linked:!0,interpolate_tension:1,y_label:"Days",area:t.area})}var _={past_n_days:"",stepwise_compare_lines:["block"],panchyat_compare_lines:"",labels:["Muster roll closure to muster roll entry","Muster roll entry to wage list generation","Wage list generation to wage list sign","Wage list sign to FTO generation","FTO generation to first signature","First signature to second signature","Second signature to processed by bank"],stepCols:[1,2,3,4,5,6,7]};d3.json("data/delays_sample.json").on("progress",function(){console.info("progress",d3.event.loaded)}).get(function(e,a){t(a)}),d3.selectAll(".modify-time-period-controls button").on("click",function(){var t=d3.select(d3.event.target);d3.selectAll(".modify-time-period-controls button").classed("selected",!1),t.classed("selected",!0),_.past_n_days=t.attr("data-timeperiod"),o(),r(),i()}),d3.selectAll(".blockSelector").on("click",function(){_.stepwise_compare_lines=[],d3.selectAll(".blockSelector").each(function(){this.checked===!0&&_.stepwise_compare_lines.push(this.value)}),r()}),d3.selectAll("#panchayat_step_controls").on("change",function(){_.panchyat_compare_lines=d3.event.target.value,i()})}();