!function(){"use strict";function e(e){d.data=e,s(),o(),l(d.data.panchayats),r()}function t(e,t,n,l){if(""!==t){var s=new Date;s.setDate(s.getDate()-t)}var o=[];return e.forEach(function(e,t){(!s||a(e[0])>=s)&&n.forEach(function(t,n){var s={date:a(e[0])};s.value=l&&o[n-1]?e[t]+o[n-1][o[n-1].length-1].value:e[t],o[n]=o[n]||[],o[n].push(s)})}),o}function a(e){var t=e.substring(0,4),a=e.substring(4,6),n=e.substring(6,8);return new Date(t,a,n)}function n(){if(""!==d.past_n_days){var e=new Date;e.setDate(e.getDate()-d.past_n_days)}var t=10;return d.stepwise_compare_lines.forEach(function(n,l){d.data[n].data.forEach(function(n){d.stepCols.forEach(function(l){(!e||a(n[0])>=e)&&n[l]>t&&(t=n[l])})})}),t}function l(e){d3.select(".panchayat_charts-container").selectAll("div").data(e).enter().append("div").classed("pure-u-6-24",!0).html(function(e,t){return'<div class="chart-holder small_chart"><div id="p_'+e.panchayat_code+'"></div><div class="p_'+e.panchayat_code+'_legend"></div></div>'})}function s(){var e=t(d.data.block.data,d.past_n_days,d.stepCols,!0);i({data:e,title:"Block Performance",target:"#block_performance",legend_target:".legend",labels:d.labels})}function o(){n();d.stepCols.forEach(function(e,a){var n=[];d.stepwise_compare_lines.forEach(function(a,l){var s=t(d.data[a].data,d.past_n_days,[e],!1);n.push(s[0])}),c({data:n,title:d.data.config.headers[e],target:"#s_"+e,legend_target:".s_"+e+"_legend",labels:d.labels,area:!1})})}function r(){d.data.panchayats.forEach(function(e,a){var n=""!==d.panchyat_compare_lines?[d.panchyat_compare_lines]:d.stepCols,l=""===d.panchyat_compare_lines?!0:!1,s=t(e.data,d.past_n_days,n,l);c({data:s,title:e.panchayat_name,target:"#p_"+e.panchayat_code,legend_target:".p_"+e.panchayat_code+"_legend",labels:d.labels})})}function i(e){MG.data_graphic({title:e.title,data:e.data,width:600,height:400,left:80,full_width:!0,target:e.target,baselines:[{value:15,label:"Ideal"}],xax_count:20,legend:e.labels,legend_target:e.legend_target,show_tooltips:!1,aggregate_rollover:!0,show_year_markers:!0,transition_on_update:!1,interplate:"linear",interpolate_tension:1,area:!0,y_label:"Days",mouseover:function(e,t){e.values.forEach(function(e,t){var a=d3.formatPrefix(e.value),n=d3.select(".legend .mg-line"+e.line_id+"-legend-color");n.text(" "),n.text("â€” "+d.labels[t]+" : "+a.scale(e.value).toFixed(2))})}})}function c(e){MG.data_graphic({title:e.title,data:e.data,width:295,height:200,right:10,left:80,small_text:!0,xax_count:1,target:e.target,full_width:!0,transition_on_update:!1,max_y:e.max_y||void 0,interplate:"linear",interpolate_tension:1,y_label:"Days",area:e.area})}var d={past_n_days:"",stepwise_compare_lines:["block"],panchyat_compare_lines:"",labels:["Muster roll closure to muster roll entry","Muster roll entry to wage list generation","Wage list generation to wage list sign","Wage list sign to FTO generation","FTO generation to first signature","First signature to second signature","Second signature to processed by bank"],stepCols:[1,2,3,4,5,6,7]};d3.json("data/delays_sample.json").on("progress",function(){console.info("progress",d3.event.loaded)}).get(function(t,a){e(a)}),d3.selectAll(".modify-time-period-controls button").on("click",function(){var e=d3.select(d3.event.target);d3.selectAll(".modify-time-period-controls button").classed("selected",!1),e.classed("selected",!0),d.past_n_days=e.attr("data-timeperiod"),s(),o(),r()}),d3.selectAll(".blockSelector").on("click",function(){d.stepwise_compare_lines=[],d3.selectAll(".blockSelector").each(function(){this.checked===!0&&d.stepwise_compare_lines.push(this.value)}),o()}),d3.selectAll("#panchayat_step_controls").on("change",function(){d.panchyat_compare_lines=d3.event.target.value,r()})}();